; худо бедно да работает


; ????? ????

code_seg segment ;?????? ????????

assume cs: code_seg
assume ds: code_seg, ss: code_seg

org 100h

start:

	mov num,50h
	mov numoff,0h

	mov ah, 09h ;????? ??????
	mov dx, offset vvod
	int 21h

	mov dx, offset filename
	mov ah, 0Ah ; 0Ah -  ???? ?????? ? ?????, ??? ? ?????, ? DX ????????????? ?? ??? ????? ? ??????
	int 21h
	
	; ????? ??? ???????? |xor bh,bh| ; xor - ??????? "?? ???", ? ?????? ?????????? ?? ??????? ????? ??? ???? ??? ??? ??? ??????? ????????? ???????? BH 
	mov bh,0 ; ????????? ?? ????????
	mov bl, filename[1] ; ???? ??
	mov filename[bx+2],0 ; ???? ??
	mov al,0 ; ????????? AL ????? ??? ????? ??????????
	mov ah, 3Dh ; 3Dh - ???????? ?????
	mov dx, offset filename+2 ; ???? ??
	int 21h
	
	mov Handler, ax
	jnc noerror1 ; ??????? ???? ??? ?????? ?? ???? CF=0
	mov ah,09h ; ???? ???? ??????, ?? ????????? ????????? ?? ??????
	mov dx, offset errorletter
	int 21h
	int 20h
	
noerror1:
	
	mov ah, 3Fh ; 3Fh - ?????? ???? ????? ?????????
	mov bx, Handler
	mov cx, 07CFh ; 7CF=1999 ?????? ????? ??????????? ????(????????) 25?80=2000
	mov dx, offset BufIn
	int 21h
	
	jnc noerror2 ; ??????? ???? ??? ?????? ?? ???? CF=0
	mov dx, offset errorletter
	int 21h
	int 20h
	
noerror2:
	
	mov cx,ax ; ???? ??
	push ax ; ???? ??, ?? ???????????? ????? ??????? ??? ??? ??? ?? ??????? ?? ?????
	; ?????? ????? ??? ????? ????? ????????? ???????? AX ??? ?????
	
	mov ah, 02h
	mov dx, 0Dh ; D=13 ; ??????? ???????????? ??????????? ?????? ? ?????? ??????? ???????(?? ? ?????)
	int 21h
	
	mov ah, 02h
	mov dx, 0Ah ; A=10 ; ?? ???? ???????????? ?? ????? ??????? ? ????... ; ??? ? ?????, ???? Enter, ? ????? ????????????
	int 21h
	
	lea si, BufIn ; ???? ??
	mov di, cx ; ???? ??
	

doublespese:

    mov ah,02h
    mov dl,20h	
	int 21h
	
    mov ah,02h
    mov dl,20h	
	int 21h
	
cycle: ; ??? ????? ???????? ????????
	
	lodsb ; ??????? ???? ?? ?????? DS:(E)SI ? AL
	
	dec num

	cmp al, 41h ;  ????????? ???? AL ? 40h
	jb exchange ; ???? < ?? ?????? ?? exchange
	
	cmp al, 5Bh ; ????????? AL ? 5Bh
	je exchange ; ???? = ?? ?????? ?? exchange
	
	cmp al, 5Ch ; ????????? AL ? 5Ch
	je exchange ; ???? = ?? ?????? ?? exchange
	
	cmp al, 5Dh ; ????????? AL ? 5Dh
	je exchange ; ???? = ?? ?????? ?? exchange

	cmp al, 5Eh ; ????????? AL ? 5Eh
	je exchange ; ???? = ?? ?????? ?? exchange

	cmp al, 5Fh ; ????????? AL ? 5Fh
	je exchange ; ???? = ?? ?????? ?? exchange
	
	cmp al, 60h ; ????????? AL ? 60h
	je exchange ; ???? = ?? ?????? ?? exchange
	
	cmp al, 7Ah ; ????????? AL ? 7Ah 
	ja exchange ; ???? > ?? ?????? ?? exchange
	
print:
	
	mov ah, 02h
	mov dx,0 ; ?????????, ????? ?? ??????, ????? ????? ?? ???? ???? ????? ???????, ? ???... ??????...
	mov dl, al
	int 21h  
	
	cmp num,0
	jne nokrat 
	
	mov num,52h
	inc numoff
	
	cmp numoff,19h
	je off
	
w:	
	mov ah,01h
	int 21h
	cmp al, 0Dh ;  ??????? ?????
	je wenter
	
	mov ah, 09h ;????? ??????
	mov dx, offset weenter
	int 21h
	jmp w 
	
wenter:	

	lea dx, ent
	mov ah,09h
	int 21h
	
nokrat:
	
	loop cycle
	jmp print
	jmp print
	
exchange:

	mov al,20h ; ?????? ?? " " (?.?. spase)
	jmp print
	
off:
	int 20h

numoff dw 0h

num dw 0h

weenter db "press Enter please $"
	
vvod db "enter file name: $" ; db - ????????? ?????? ??? 1 ????

filename db 15,0,15 dup() ; dup() - ? ??????? ??????????? ??? ????? ????????? 
; 15 - ???????????? ????? ????? 
; 0 - ?????????????? ????? (?? ????? ??? ????? 0)
; 15 dum() - 15 '?????????' ?????????? ??? ????? ??? 

errorletter db "error, please reload program... $"

Handler DW ?

BufIn DB 2048 dup(1) ; ??? ? ?????:
; DB - ?????????? ??? ????????? ???????
; 2048 - ???-?? ????????, ?????? ??????? ? ??
; dup(1) - ????????? 2048 ?????????

ent db 10,13, '$'

code_seg ends ;????? ????????

end start 
